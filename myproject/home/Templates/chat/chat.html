{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messenger</title>
    <link rel="stylesheet" href="{% static 'chat/style.css' %}">
</head>
<body>
    <div class="chat-container">
        <!-- Sidebar v·ªõi danh s√°ch chat -->
        <div class="chat-sidebar" id="chatSidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">
                    <a href="{% url 'home' %}" style="text-decoration: none; color: inherit; margin-right: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                    </a>
                    Messenger
                </h2>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="T√¨m ki·∫øm trong Messenger">
                <div class="search-results"></div>
            </div>
            
            <div class="chat-list" id="chatList">
                {% for item in conversations %}
                    {% with conv=item.conversation other=item.other_user %}
                    <div class="chat-item" 
                         data-user-id="{{ other.id }}" 
                         data-conv-id="{{ conv.id }}" 
                         onclick="selectChat(
                            '{{ other.id }}', 
                            '{{ other.full_name }}' ,
                            '{{ conv.id }}',
                            '{% if other.avatar %}{{ other.avatar.url }}{% else %}null{% endif %}')">
                        <div class="avatar">
                            {% if other.avatar %}
                                <img src="{{ other.avatar.url }}" alt="avatar">
                            {% else %}
                                {{ other.full_name|slice:":1"|upper }}
                            {% endif %}
                        </div>
                        
                        <div class="chat-info">
                            <div class="chat-name">{{ other.full_name }}</div>
                            <div class="chat-bottom">
                            <div class="chat-preview">
                                {% if conv.messages.last %}
                                    {% if conv.messages.last.sender_id == request.user.id %}
                                        <span class="sender-label">B·∫°n:</span>
                                {% endif %}
                                    {{ conv.messages.last.text|truncatechars:20 }}
                                {% else %}
                                    (Ch∆∞a c√≥ tin nh·∫Øn)
                                {% endif %}
                            </div>
                            <div class="chat-time">
                                {% if conv.messages.last %}
                                    {{conv.messages.last.created_at|date:"H:i"}}
                                {% endif %}
                            </div>
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                {% endfor %}
            </div>
            
            
            
        </div>
        
        <!-- Khu v·ª±c chat ch√≠nh -->
        <div class="chat-main mobile-show" id="chatMain">
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="header-avatar" id="headerAvatar"></div>
                    <div>
                        <div class="header-name" id="headerName"></div>
                        <div class="header-status"></div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn">‚ÑπÔ∏è</button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                {% comment %} <div class="message received">
                    <div class="message-avatar">N</div>
                    <div class="message-content">Ch√†o b·∫°n! B·∫°n c√≥ kh·ªèe kh√¥ng?</div>
                </div>
                <div class="message-time" style="text-align: left; margin-left: 44px;">14:30</div>
                
                <div class="message sent">
                    <div class="message-content">Ch√†o b·∫°n! M√¨nh kh·ªèe, c·∫£m ∆°n b·∫°n ƒë√£ h·ªèi thƒÉm</div>
                </div>
                <div class="message-time" style="text-align: right; margin-right: 12px;">14:32</div>
                
                <div class="message received">
                    <div class="message-avatar">N</div>
                    <div class="message-content">Tuy·ªát qu√°! M√¨nh c√≥ m·ªôt tin t·ª©c th√∫ v·ªã mu·ªën chia s·∫ª v·ªõi b·∫°n</div>
                </div>
                <div class="message-time" style="text-align: left; margin-left: 44px;">14:35</div>
                
                <div class="message sent">
                    <div class="message-content">Tin g√¨ th·∫ø? K·ªÉ m√¨nh nghe ƒëi!</div>
                </div>
                <div class="message-time" style="text-align: right; margin-right: 12px;">14:36</div>
                
                <div class="message received">
                    <div class="message-avatar">N</div>
                    <div class="message-content">M√¨nh v·ª´a ƒë∆∞·ª£c nh·∫≠n v√†o c√¥ng ty m·ªõi! üéâ</div>
                </div>
                <div class="message-time" style="text-align: left; margin-left: 44px;">14:38</div>
                
                <div class="message sent">
                    <div class="message-content">Ch√∫c m·ª´ng b·∫°n! ƒê√≥ l√† tin tuy·ªát v·ªùi ƒë·∫•y!</div>
                </div>
                <div class="message-time" style="text-align: right; margin-right: 12px;">14:39</div>
                
                <div class="message sent">
                    <div class="message-content">C·∫£m ∆°n b·∫°n nhi·ªÅu!</div>
                </div>
                <div class="message-time" style="text-align: right; margin-right: 12px;">14:40</div> {% endcomment %}
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea class="message-input" placeholder="Aa" rows="1" id="messageInput"></textarea>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'chat/script.js' %}"></script>
</body>
</html>